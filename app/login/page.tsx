"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { ArrowLeft, Mail, Lock, MessageCircle } from "lucide-react";
import { motion } from "framer-motion";
import Link from "next/link";

// ğŸ”¥ [ìˆ˜ì • ì™„ë£Œ] TypeScript ê²½ë¡œ ì—ëŸ¬ í•´ê²°ì„ ìœ„í•´ ìƒëŒ€ ê²½ë¡œë¥¼ ì •í™•íˆ ì¡ì•˜ìŠµë‹ˆë‹¤.
// (app/login/page.tsx ê¸°ì¤€ìœ¼ë¡œ ë‘ ë‹¨ê³„ ìœ„ë¡œ ì˜¬ë¼ê°€ì„œ src/lib/apië¥¼ ì°¾ìŒ)
import { API_BASE_URL } from "../../src/lib/api"; 

export default function LoginPage() {
  const router = useRouter();
  const [formData, setFormData] = useState({ email: "", password: "" });

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };

  const handleLogin = async () => {
    try {
      // ğŸ”¥ [í•µì‹¬ ìˆ˜ì •] "http://localhost:8080" ë¶€ë¶„ì„ ë³€ìˆ˜ë¡œ ì™„ë²½íˆ êµì²´í–ˆìŠµë‹ˆë‹¤.
      const res = await fetch(`${API_BASE_URL}/api/v1/auth/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      if (res.ok) {
        const data = await res.json();
        localStorage.setItem("user", JSON.stringify(data));
        alert(`${data.nickname}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);
        router.push("/");
      } else {
        alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: ì•„ì´ë””ë‚˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
      }
    } catch (e) {
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨ (GCP ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”)");
    }
  };

  const handleSocialLogin = (provider: string) => {
    // ğŸ”¥ [í•µì‹¬ ìˆ˜ì •] ì†Œì…œ ë¡œê·¸ì¸ ì£¼ì†Œë„ localhostë¥¼ ì§€ìš°ê³  ë³€ìˆ˜ë¡œ êµì²´í–ˆìŠµë‹ˆë‹¤.
    window.location.href = `${API_BASE_URL}/oauth2/authorization/${provider}`;
  };

  return (
    <div className="min-h-screen flex items-center justify-center p-4 relative overflow-hidden bg-black">
      
      {/* ğŸ¥ ë°°ê²½ ë¹„ë””ì˜¤ */}
      <video
        autoPlay
        loop
        muted
        playsInline
        className="absolute inset-0 w-full h-full object-cover z-0"
      >
        <source src="/login-bg.mp4" type="video/mp4" />
      </video>

      {/* ğŸŒ‘ ë¹„ë””ì˜¤ ìœ„ ì–´ë‘ìš´ ë§‰ */}
      <div className="absolute inset-0 bg-black/60 backdrop-blur-[2px] z-0" />

      {/* âœ¨ ë³´ë¼ìƒ‰ ë¹› íš¨ê³¼ (ëª¨ë°”ì¼ ë°˜ì‘í˜• í¬ê¸° ì¡°ì ˆ) */}
      <div className="absolute bottom-[-10%] left-[-10%] w-[300px] md:w-[500px] h-[300px] md:h-[500px] bg-violet-600/30 rounded-full blur-[80px] md:blur-[120px] z-0 pointer-events-none" />

      {/* ğŸ“¦ ë¡œê·¸ì¸ ë°•ìŠ¤ (ëª¨ë°”ì¼ ë°˜ì‘í˜• íŒ¨ë”©, ë§ˆì§„ ì¡°ì ˆ) */}
      <motion.div
        initial={{ opacity: 0, scale: 0.95 }}
        animate={{ opacity: 1, scale: 1 }}
        className="w-full max-w-md bg-black/40 backdrop-blur-xl border border-white/10 p-6 md:p-8 rounded-2xl md:rounded-3xl shadow-2xl relative z-10 mx-2 md:mx-0"
      >
        <button onClick={() => router.back()} className="absolute top-4 left-4 md:top-6 md:left-6 text-white/50 hover:text-white transition-colors p-1">
          <ArrowLeft size={20} className="md:w-6 md:h-6" />
        </button>
        
        <h1 className="text-2xl md:text-3xl font-black text-center mb-1 md:mb-2 text-white tracking-tighter italic mt-4 md:mt-0">
            LOGIN
        </h1>
        <p className="text-center text-white/60 text-xs md:text-sm mb-6 md:mb-8">POP SPOTì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</p>

        <div className="space-y-3 md:space-y-4">
          <div className="relative">
            <input name="email" type="email" placeholder="ì´ë©”ì¼" onChange={handleChange}
              className="w-full bg-white/5 border border-white/10 rounded-lg md:rounded-xl p-3 md:p-4 pl-10 md:pl-12 text-sm md:text-base text-white focus:border-indigo-500 outline-none transition-colors placeholder:text-white/30" />
            <Mail className="absolute left-3 md:left-4 top-1/2 -translate-y-1/2 text-white/50 w-4 h-4 md:w-5 md:h-5"/>
          </div>
          <div className="relative">
            <input name="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" onChange={handleChange}
              className="w-full bg-white/5 border border-white/10 rounded-lg md:rounded-xl p-3 md:p-4 pl-10 md:pl-12 text-sm md:text-base text-white focus:border-indigo-500 outline-none transition-colors placeholder:text-white/30" />
            <Lock className="absolute left-3 md:left-4 top-1/2 -translate-y-1/2 text-white/50 w-4 h-4 md:w-5 md:h-5"/>
          </div>
        </div>

        <div className="flex justify-end mt-2 md:mt-3 mb-5 md:mb-6">
          <Link href="/find-account" className="text-[10px] md:text-xs text-white/50 hover:text-white transition-colors">
            ì•„ì´ë”” / ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
          </Link>
        </div>

        <button onClick={handleLogin} className="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3.5 md:py-4 rounded-lg md:rounded-xl transition-all shadow-lg mb-5 md:mb-6 shadow-indigo-500/20 text-sm md:text-base">
          ë¡œê·¸ì¸
        </button>

        <div className="relative flex py-1 md:py-2 items-center">
            <div className="flex-grow border-t border-white/10"></div>
            <span className="flex-shrink-0 mx-3 md:mx-4 text-white/30 text-[10px] md:text-xs">ë˜ëŠ” ì†Œì…œ ë¡œê·¸ì¸</span>
            <div className="flex-grow border-t border-white/10"></div>
        </div>

        <div className="space-y-2.5 md:space-y-3 mt-4 md:mt-6">
            <button 
                onClick={() => handleSocialLogin("kakao")}
                className="w-full py-2.5 md:py-3 rounded-lg md:rounded-xl font-bold bg-[#FEE500] text-[#000000] hover:bg-[#FDD835] transition-transform hover:scale-[1.02] flex items-center justify-center gap-2 md:gap-3 text-xs md:text-base"
            >
                <MessageCircle size={16} className="md:w-5 md:h-5" fill="black" />
                <span>ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°</span>
            </button>

            <button 
                onClick={() => handleSocialLogin("naver")}
                className="w-full py-2.5 md:py-3 rounded-lg md:rounded-xl font-bold bg-[#03C75A] text-white hover:bg-[#02b351] transition-transform hover:scale-[1.02] flex items-center justify-center gap-2 md:gap-3 text-xs md:text-base"
            >
                <span className="font-black text-base md:text-lg">N</span>
                <span>ë„¤ì´ë²„ë¡œ ì‹œì‘í•˜ê¸°</span>
            </button>

            <button 
                onClick={() => handleSocialLogin("google")}
                className="w-full py-2.5 md:py-3 rounded-lg md:rounded-xl font-bold bg-white text-black border border-white/20 hover:bg-gray-100 transition-transform hover:scale-[1.02] flex items-center justify-center gap-2 md:gap-3 text-xs md:text-base"
            >
                <svg className="w-4 h-4 md:w-5 md:h-5" viewBox="0 0 24 24">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                </svg>
                <span>Googleë¡œ ì‹œì‘í•˜ê¸°</span>
            </button>
        </div>

        <div className="mt-6 md:mt-8 text-center">
            <p className="text-white/40 text-xs md:text-sm">ì•„ì§ íšŒì›ì´ ì•„ë‹ˆì‹ ê°€ìš”?</p>
            <Link href="/signup">
                <button className="mt-2 md:mt-3 w-full border border-white/10 bg-white/5 hover:bg-white/10 text-white font-bold py-2.5 md:py-3 rounded-lg md:rounded-xl transition-all text-xs md:text-sm">
                    ì´ë©”ì¼ë¡œ íšŒì›ê°€ì… í•˜ê¸°
                </button>
            </Link>
        </div>
      </motion.div>
    </div>
  );
}